<!DOCTYPE html>
<html>
	<title> start from scratch </title>
	<head>
		<style>
			body {
				margin : 0px;
				margin-top : 0px;
			}
		</style>
	</head>
	<body>
		<input type = "text" list = "countryList" style = "position : absolute ; width : 10vw; height : 2vw ; left : 26.5vw;" onchange = "getGithubCountryRepo(this.value)">
	  <script>
		
			//these two variables will help with prediction the country name
			var countryInputBox = document.getElementById("inputBox");
			var countryList = document.createElement("datalist");
			
			var buttonPanel = document.createElement("div");
			var rightButton = document.createElement("button");
			var leftButton = document.createElement("button");
			var newsTable;

			//photoSet is a panel to set the photo on
			var photoSet;
			var googleStaticMap;
		
			var infoTable;
			
			document.body.appendChild(countryList);
			countryList.id = "countryList";
			document.body.appendChild(buttonPanel);
			buttonPanel.appendChild(rightButton);	
			buttonPanel.style.position = "absolute";
			buttonPanel.style.top = "44vw";
			buttonPanel.style.left = "47.5vw";
			buttonPanel.style.width = "5vw";
			rightButton.innerText = "Next";
			rightButton.style.position = "absolute";
			rightButton.style.left = "0vw";
			rightButton.style.width = "2.5vw";
			rightButton.style.height = "1.5vw";
			buttonPanel.appendChild(leftButton);
			
			
			//this function help build a text predicter in the input box
			function pullCountryNames() {
				var countryNamesRequest = new XMLHttpRequest();
				countryNamesRequest.open("get", 'https://raw.githubusercontent.com/mledoze/countries/master/countries.json', true);
				countryNamesRequest.send();
				countryNamesRequest.onload = function() {
					JSON.parse(this.responseText).forEach(function(countryItem) {
						var option = document.createElement("option");
						countryList.appendChild(option);
						option.value = countryItem.name.common;
					});
				}
			}
			
			//this is the main function 
			function getGithubCountryRepo(country) {	
				//limit the number of flickr's photos at each request to be 5
				var i = -5;
				var max = 0;
			  var countryRequest = new XMLHttpRequest();
				var countryArea = document.createElement("td");
				var countryRegion = document.createElement("td");
				var countryCapital = document.createElement("td");
				var countryCurrency = document.createElement("td");
				var countryCoordinates = document.createElement("td");
				var countryRow = document.createElement("tr");
				var countryRow2 = document.createElement("tr");
				var countryRow3 = document.createElement("tr");
				var countryRow4 = document.createElement("tr");
				var countryRow5 = document.createElement("tr");
				var countryRow6 = document.createElement("tr");	
				var countryRow7 = document.createElement("tr");
				var infoTableHeader = document.createElement("tr");
				var infoTableHeaderData = document.createElement("th");
				weather = document.createElement("td");
				weather2 = document.createElement("td");
			
			if (photoSet) {
					document.body.removeChild(photoSet);
					photoSet = document.createElement("div");
					document.body.appendChild(photoSet);
				}
			
				if (!infoTable){
					infoTable = document.createElement("table");
				} else {
					document.body.removeChild(infoTable);
					infoTable = document.createElement("table");
				}
				
				//make a xhr request to a github repo to get information about the desired country
				countryRequest.open("get", 'https://raw.githubusercontent.com/mledoze/countries/master/countries.json', true);
				countryRequest.send();
				countryRequest.onload = function() {

					//build up a table to set the information on
					infoTable = document.createElement("table");
					document.body.appendChild(infoTable);		
					infoTable.appendChild(infoTableHeader);
					infoTableHeader.appendChild(infoTableHeaderData);
					infoTableHeaderData.innerText = "General Information";
					infoTable.appendChild(countryRow);
					infoTable.appendChild(countryRow2);
					infoTable.appendChild(countryRow3);
					infoTable.appendChild(countryRow4);
					infoTable.appendChild(countryRow5);
					infoTable.appendChild(countryRow6);
					infoTable.appendChild(countryRow7);
					countryRow.appendChild(countryArea);
					countryRow2.appendChild(countryRegion);
					countryRow3.appendChild(countryCapital);
					countryRow4.appendChild(countryCoordinates);
					countryRow5.appendChild(countryCurrency);
					countryRow6.appendChild(weather);
					countryRow7.appendChild(weather2);
					infoTable.style.position = "absolute";
					infoTable.style.left = "38vw";
					infoTable.style.height = "25vw";
					infoTable.style.border = "solid 2px red";
					
					for (var j = 0; i < JSON.parse(this.responseText).length; j++) { 
						if (JSON.parse(this.responseText)[j].name.common === country) {
						  var officialName = JSON.parse(this.responseText)[j].name.official;
							var commonName = JSON.parse(this.responseText)[j].name.common;
							var latitudeLongitude = JSON.parse(this.responseText)[j].latlng;
							countryCurrency.innerHTML = "Currency = " + JSON.parse(this.responseText)[j].currency;
							countryCoordinates.innerHTML = "Latitude = " + latitudeLongitude[0] + "</br>" + "Longitude = " + latitudeLongitude[1];
							countryArea.innerHTML = "Area = " + JSON.parse(this.responseText)[j].area + " Square Kilometer";
							countryRegion.innerHTML = "Region = " + JSON.parse(this.responseText)[j].region;
							countryCapital.innerHTML = "Capital City = " + JSON.parse(this.responseText)[j].capital;
							
							//call weather, guardian and googleStaticMap apis
							getWeather(latitudeLongitude, weather, weather2);
							pullLatestNews(country);
							drawGoogleMap(latitudeLongitude, JSON.parse(this.responseText)[j].area);
							
							rightButton.onclick = function() {
								if (i === 0) {
									buttonPanel.appendChild(leftButton);
									leftButton.innerText = "back";
									leftButton.style.position = "absolute"
									leftButton.style.left = "2.5vw";
									leftButton.style.width = "2.5vw";
									leftButton.style.height = "1.5vw";
									leftButton.onclick = function() {
										if (i > 0){
											i -= 5;
											max -= 5;
											getFlickrPhotos(commonName, i, max);
										}	
									}
								}
								if (max <= 100){
									i += 5;
									max += 5;
									getFlickrPhotos(commonName, i, max);
								}
							}
							break;
						}
					}
				}
			}	
			
			function getWeather(latitudeLongitude, weather, weather2) {
				var latitude = latitudeLongitude[0];
				var longitude = latitudeLongitude[1];
				var makeWeatherRequest = new XMLHttpRequest();
				makeWeatherRequest.open("get", 'http://api.openweathermap.org/data/2.5/weather?lat=' + latitude +
				'&lon=' + longitude + '&appid=bd5bc1519755874543545ebe815796ba', true);
				makeWeatherRequest.send();
				makeWeatherRequest.onload = function() {
					weather.innerHTML = "Weather Description = " + JSON.parse(this.responseText).weather[0].description;
					weather2.innerHTML	= "Temprature = " + (JSON.parse(this.responseText).main.temp - 273.15, 2).toFixed() + "  Celsius" ;
				}
			}
			
			function getFlickrPhotos(country, i, max) {	
				var init = -16.5;
					if (!photoSet) {
					photoSet = document.createElement("div");
					document.body.appendChild(photoSet);
				} else {
					document.body.removeChild(photoSet);
					photoSet = document.createElement("div");
					document.body.appendChild(photoSet);
				}
				
				var makeFlickrRequest = new XMLHttpRequest();
				makeFlickrRequest.open("get", 'https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key='+
				'	d25561a9209c49fa69fe6e813cb922fc&tags=' +country + '&extras=url_l&format=json&nojsoncallback=1', true);
				makeFlickrRequest.send();
				makeFlickrRequest.onload = function() {
					for (i = i ; i < max ; i++){
						if (JSON.parse(this.responseText).photos.photo[i]) {
							if (JSON.parse(this.responseText).photos.photo[i].url_l) {
								if(JSON.parse(this.responseText).photos.photo[i]){
									var photoFrame = document.createElement("photo");
									photoSet.appendChild(photoFrame);
									photoFrame.style.position = "relative";
									photoFrame.style.left = init + 19 + "vw";
									photoFrame.innerHTML = "<img src = 	" + JSON.parse(this.responseText).photos.photo[i].url_l + " " + "style = 'border : solid 0px blue ;width : 19vw ; height : 19vw;'" + "/>"
								}	
							}
						}
					}
				}
			}
			

			function drawGoogleMap(latitudeLongitude, area) {
				var latitude = latitudeLongitude[0];
				var longitude = latitudeLongitude[1];
				var zoom;
				
				if (area > 5000000){
					zoom = 3;
				} else if (area > 1000000) {
					zoom = 4;
				} else {
					zoom = 6;
				}
				if(!googleStaticMap){
					googleStaticMap = document.createElement("photo");
				} else {
					document.body.removeChild(googleStaticMap);
					googleStaticMap = document.createElement("photo");
				}
				
				document.body.appendChild(googleStaticMap);
				googleStaticMap.innerHTML = "<img src = " + 'https://maps.googleapis.com/maps/api/staticmap?' + 'center=' + latitude + ',' + longitude +'&' +
				'zoom=' + zoom +'&size=600x300&maptype=roadmap&markers=color:green%7Clabel:G%7C' + latitude + ',' + longitude + " " + "style = 'postion : absolute ; top : 0px;width : 25vw ; height : 25vw;'" + '/>';
			}
		

		
		
			//pull latest news from guardian api
			function pullLatestNews(country) {
				
				if (!newsTable){
					newsTable = document.createElement("table");
				} else {
					document.body.removeChild(newsTable);
					newsTable = document.createElement("table");
				}
				
				var tbody = document.createElement("tbody");
				var row = document.createElement("tr");
				var td = document.createElement("td");
				var th = document.createElement("th");
				
				document.body.appendChild(newsTable);
				newsTable.appendChild(tbody);
				tbody.appendChild(row);
				row.appendChild(th);
				th.innerHTML = "NEWS";
				newsTable.style.position = "absolute";
				newsTable.style.left = "70vw";
				newsTable.style.height = "50vh";	
				newsTable.style.border = "solid 2px red";
				newsTable.style.height = "25vw";
				var newsRequest = new XMLHttpRequest();
				
				newsRequest.open("get", "http://content.guardianapis.com/search?q=" + country + "&from-date=2016-01-01&api-key=f941d0d2-0ab3-419c-b9df-c1107595e92b", true);
				newsRequest.send();
				newsRequest.onload = function() {
					JSON.parse(this.responseText).response.results.forEach(function(item) {
						var row = document.createElement("tr");
						var td  = document.createElement("td");
						row.appendChild(td);
						tbody.appendChild(row);
						var newsLink = document.createElement("a");
						td.appendChild(newsLink);
						newsLink.innerHTML = item.webTitle;
						newsLink.href = item.webUrl;
					});
				}
			}
			
			pullCountryNames();
		
		</script>
	</body>
</html>
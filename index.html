<!DOCTYPE html>
<html>
	<title> start from scratch </title>
	<head>
		<style>
			body {
				margin : 0px;
				margin-top : 0px;
			}
		</style>
	</head>
	<body>
		<input type = "text" list = "countryList" style = "position : absolute ; width : 5vw; height : 2vw ; left : 30vw;" onchange = "getGithubCountryRepo(this.value)">
	  <script>
			var countryInputBox = document.getElementById("inputBox");
			var countryList = document.createElement("datalist");
			var countryInfo;
			var buttonPanel = document.createElement("div");
			var rightButton = document.createElement("button");
			var leftButton = document.createElement("button");
									
			//photoSet is a panel to set the photo on
			var photoSet;
			var googleStaticMap;
			document.body.appendChild(countryList);
			countryList.id = "countryList";
			document.body.appendChild(buttonPanel);
			buttonPanel.appendChild(rightButton);
			buttonPanel.style.position = "absolute";
			buttonPanel.style.top = "44vw";
			buttonPanel.style.left = "47.5vw";
			buttonPanel.style.width = "5vw";
			rightButton.innerText = "Next";
			rightButton.style.position = "absolute";
			rightButton.style.left = "0vw";
			rightButton.style.width = "2.5vw";
			rightButton.style.height = "1.5vw";
			buttonPanel.appendChild(leftButton);
			
			function getWeather(latitudeLongitude, weather) {
				var latitude = latitudeLongitude[0];
				var longitude = latitudeLongitude[1];
				var makeWeatherRequest = new XMLHttpRequest();
				makeWeatherRequest.open("get", 'http://api.openweathermap.org/data/2.5/weather?lat=' + latitude +
				'&lon=' + longitude + '&appid=bd5bc1519755874543545ebe815796ba', true);
				makeWeatherRequest.send();
				makeWeatherRequest.onload = function() {
				weather.innerHTML = JSON.parse(this.responseText).weather[0].description + "</br>" + (JSON.parse(this.responseText).main.temp - 273.15, 2).toFixed() + "  Celsius" ;
				}
			
			}
			
			function getFlickrPhotos(country, i, max) {	
				var init = -16.5;
					if (!photoSet) {
					photoSet = document.createElement("div");
					document.body.appendChild(photoSet);
				} else {
					document.body.removeChild(photoSet);
					photoSet = document.createElement("div");
					document.body.appendChild(photoSet);
				}
				
					var makeFlickrRequest = new XMLHttpRequest();
					makeFlickrRequest.open("get", 'https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key='+
					'	d25561a9209c49fa69fe6e813cb922fc&tags=' +country + '&extras=url_l&format=json&nojsoncallback=1', true);
					makeFlickrRequest.send();
					makeFlickrRequest.onload = function() {
						for (i = i ; i < max ; i++){
							var photoFrame = document.createElement("photo");
							photoSet.appendChild(photoFrame);
							photoFrame.style.position = "relative";
							photoFrame.style.left = init + 19 + "vw";
							photoFrame.innerHTML = "<img src = 	" + JSON.parse(this.responseText).photos.photo[i].url_l + " " + "style = 'border : solid 0px blue ;width : 19vw ; height : 19vw;'" + "/>"
						}
					}
				}
			
			
			function getGithubCountryRepo(country) {
				if (photoSet) {
					document.body.removeChild(photoSet);
					photoSet = document.createElement("div");
					document.body.appendChild(photoSet);
				}
			
				if (!countryInfo){
					countryInfo = document.createElement("div");
				} else {
					document.body.removeChild(countryInfo);
					countryInfo = document.createElement("div");
				}
				
				//set i and max to limit the number of flickr's photos at each request to be 5
				var i = -5;
				var max = 0;
			  var countryRequest = new XMLHttpRequest();
				var countryArea = document.createElement("p");
				var countryRegion = document.createElement("p");
				var countryCapital = document.createElement("p");
				var countryCurrency = document.createElement("p");
				var countryCoordinates = document.createElement("p");
				var weather = document.createElement("p");
				countryRequest.open("get", 'https://raw.githubusercontent.com/mledoze/countries/master/countries.json', true);
				countryRequest.send();
				countryRequest.onload = function() {
					countryInfo.style.position = "absolute";
					countryInfo.style.left = "50vw";
					countryInfo.style.top = "0px"
					countryInfo.style.width = "25vw";
					countryInfo.style.height = "25vw"
					countryInfo.style.border = "solid 2px blue"
					countryCurrency.style.position = "absolute"
					countryInfo.appendChild(countryCurrency);
					document.body.appendChild(countryInfo);
					countryInfo.appendChild(countryCoordinates);
					countryInfo.appendChild(countryArea);
					countryInfo.appendChild(countryRegion);
					countryInfo.appendChild(countryCapital);
					countryInfo.appendChild(weather);
					countryCoordinates.style.position = "absolute";
					countryCoordinates.style.top = "2vw"
					countryArea.style.position = "absolute";
					countryArea.style.top = "5vw"
					countryRegion.style.position = "absolute";
					countryRegion.style.top = "6.5vw";
					countryCapital.style.position = "absolute";
					countryCapital.style.top = "8.5vw";
					weather.style.position = "absolute";
					weather.style.top = "10vw";
					for (var j = 0; i < JSON.parse(this.responseText).length; j++){
						if(JSON.parse(this.responseText)[j].name.common === country){
						  var x = JSON.parse(this.responseText)[j].name.official;
							var latitudeLongitude = JSON.parse(this.responseText)[j].latlng;
							countryCurrency.innerHTML = "Currency = " + JSON.parse(this.responseText)[j].currency;
							countryCoordinates.innerHTML = "Latitude = " + latitudeLongitude[0] + "</br>" + "Longitude = " + latitudeLongitude[1];
							countryArea.innerHTML = "Area = " + JSON.parse(this.responseText)[j].area + "Square Kilometer";
							countryRegion.innerHTML = "Region = " + JSON.parse(this.responseText)[j].region;
							countryCapital.innerHTML = "Capital City = " + JSON.parse(this.responseText)[j].capital;
							rightButton.onclick = function() {
								if (i === 0) {
									buttonPanel.appendChild(leftButton);
									leftButton.innerText = "back";
									leftButton.style.position = "absolute"
									leftButton.style.left = "2.5vw";
									leftButton.style.width = "2.5vw";
									leftButton.style.height = "1.5vw";
									leftButton.onclick = function() {
										if (i > 0){
											i -= 5;
											max -= 5;
											getFlickrPhotos(x, i, max);
										}	
									}
								}
								if (max <= 30){
									i += 5;
									max += 5;
									getFlickrPhotos(x, i, max);
								}
							}
							
							getWeather(latitudeLongitude, weather);
							pullLatestNews(country);
							drawGoogleMap(latitudeLongitude);
							break;
						}
					}
				}
			}
			
			//a try to pull a map and flag image from the github repo
			function drawMap() {
				var drawMap = new XMLHttpRequest();
				drawMap.open("get", "https://raw.githubusercontent.com/mledoze/countries/master/data/usa.geo.json", true);
				drawMap.send();
				drawMap.onload = function() {
					var mapSquare = document.createElement("p");
					mapSquare.innerHTML = JSON.parse(this.responseText);
					document.body.appendChild(mapSquare);
				}
			}

		function drawGoogleMap(latitudeLongitude) {
			var latitude = latitudeLongitude[0];
			var longitude = latitudeLongitude[1];
			if(!googleStaticMap){
				googleStaticMap = document.createElement("photo");
			} else {
				document.body.removeChild(googleStaticMap);
				googleStaticMap = document.createElement("photo");
			}
			document.body.appendChild(googleStaticMap);
			googleStaticMap.innerHTML = "<img src = " + 'https://maps.googleapis.com/maps/api/staticmap?' + 'center=' + latitude + ',' + longitude +'&' +
			'zoom=6&size=600x300&maptype=roadmap&markers=color:green%7Clabel:G%7C' + latitude + ',' + longitude + " " + "style = 'postion : absolute ; top : 0px;width : 25vw ; height : 25vw;'" + '/>';
		}
		
		pullCountryNames();
		
		function pullCountryNames() {
			var countryNamesRequest = new XMLHttpRequest();
			countryNamesRequest.open("get", 'https://raw.githubusercontent.com/mledoze/countries/master/countries.json', true);

			countryNamesRequest.send();
			countryNamesRequest.onload = function() {
				JSON.parse(this.responseText).forEach(function (countryItem) {
					var option = document.createElement("option");
					countryList.appendChild(option);
					option.value = countryItem.name.common;

				});
			}
		}
		
		//pull latest news from guardian api
		function pullLatestNews(country) {
			newsPanel = document.createElement("div");
			countryInfo.appendChild(newsPanel);
			newsPanel.style.position = "absolute";
			newsPanel.style.top = "50%";
			var newsRequest = new XMLHttpRequest();
			newsRequest.open("get", "http://content.guardianapis.com/search?q=" + country + "&from-date=2016-01-01&api-key=f941d0d2-0ab3-419c-b9df-c1107595e92b", true);
			newsRequest.send();
			newsRequest.onload = function() {
				JSON.parse(this.responseText).response.results.forEach(function(item) {
					var newsParagraph = document.createElement("p");
					var newsLink = document.createElement("a");
					newsPanel.appendChild(newsParagraph);
					newsParagraph.appendChild(newsLink)
					newsLink.innerHTML = item.webTitle;
					newsLink.href = item.webUrl;
				});
			}
		}

	
		</script>
	</body>
</html>